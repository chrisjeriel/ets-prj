
<div class="cust-tabs-container">
  <h4>Accounting In-Trust / Month End / Trial Balance Processing</h4>
  <ngb-tabset (tabChange)="onTabChange($event)">
    <ngb-tab class="ngb-tab" title="Generate Trial Balance">
      <ng-template ngbTabContent>
        <div class="d-flex">
        	<div class="col-sm"></div>
        	<fieldset class="scheduler-border col-sm-6"  style="padding: 15px !important;">
        		<legend class="scheduler-border" style="visibility: hidden; padding-top: 24px !important; padding-left: 0px !important; padding-right: 0px !important;"></legend>
        		
      			<div class="input-group mt-1">
			        <label class="form-control-sm col-sm-5 pl-0 pr-1 text-right">Transaction Date</label>
              <div class="dp-cont col-sm-3">
                <datepicker [type]="'date'" [value]="tranDate" (valueChange)="tranDate=$event; checkMonth($event);"></datepicker>
              </div>
				    </div>

      			<div class="input-group cust-ig">
			        <div class="form-control-sm col-sm-5 pl-0 pr-1 text-right mb-0">
			        	<input type="checkbox" [(ngModel)]="inclPrevMon" name="">
			        </div>
	            <label class="form-control-sm text-left col-sm">Include Previous Months</label>
				    </div>
      			<div class="input-group cust-ig">
			        <div class="form-control-sm col-sm-5 pl-0 pr-1 text-right mb-0">
			        	<input type="checkbox" [(ngModel)]="inclPrevYrs" name="">
			        </div>
	            <label class="form-control-sm text-left col-sm">Include Previous Years</label>
				    </div>
      			<div class="input-group">
			        <div class="form-control-sm col-sm-5 pl-0 pr-1 text-right mb-0">
			        	<input type="checkbox" [(ngModel)]="adjEntsOnly" name="">
			        </div>
	            <label class="form-control-sm text-left col-sm">Adjusting Entries Only</label>
				    </div>

      			<div class="form-group col-sm text-center" style="margin-bottom: 5px;">
    		      <div class="cust-btn-container">
    		        <button type="button" class="cust-btn" (click)="onClickGenerate()" [disabled]="tranDate == null || tranDate == ''"><a>Generate</a></button>
                <button type="button" class="cust-btn" (click)="onClickPrint()"><a>Print</a></button>
                <!-- [disabled]="monthlyTotals.length == 0" -->
                <button type="button" class="cust-btn" (click)="onClickNewBtn('tc')" [disabled]="!canTempClose"><a>Temporary Close</a></button>
                <button type="button" class="cust-btn" (click)="onClickNewBtn('ro')" [disabled]="!canReopen"><a>Re-open</a></button>
                <button type="button" class="cust-btn" (click)="onClickPost()"><a>Post to Fiscal Year</a></button>
    		      </div>
    		    </div>
        	</fieldset>
          <div class="col-sm"></div>
        </div>
      </ng-template>
    </ngb-tab>
    <ngb-tab class="ngb-tab" title="Exit" id="Exit">
      <ng-template ngbTabContent>

      </ng-template>
    </ngb-tab>
  </ngb-tabset>
</div>

<app-modal #eomTbMdl class="d-none">
    <div header>{{ returnCode == 1 ? 'Confirmation' : 'Message' }}</div>
    <div body>
        <div class="custom-row-inline-inset" style="text-align: center">
            <p *ngIf="returnCode == 1">Trial Balance was already generated for this month. Would you like to overwrite the existing one?</p>
            <p *ngIf="returnCode == 2">This month was already Posted. Rerun of Trial Balance is not allowed.</p>
            <p *ngIf="returnCode == 3">This month was Temporarily Closed. Re-open month to rerun Trial Balance.</p>
            <p *ngIf="returnCode == 4">Production was not yet done. Please run Batch Production first.</p>
            <p *ngIf="returnCode == 5">Batch OS was not yet done. Please run Batch OS first.</p>
        </div>
    </div>
    <div footer class="w-100 text-center" [class.text-right]="returnCode == 1">
        <button *ngIf="returnCode == 1" class="cust-btn" type="button" (click)="onClickGenerate(true); eomTbMdl.closeModal();"><a>Yes</a></button>
        <button class="cust-btn" type="button" (click)="eomTbMdl.closeModal();"><a>{{ returnCode == 1 ? 'No' : 'Ok' }}</a></button>
    </div>
</app-modal>

<app-modal #eomTbMdl2 class="d-none">
    <div header>{{ 'Message' }}</div>
    <div body>
        <div class="custom-row-inline-inset" style="text-align: center">
          <ng-container *ngIf="mdl2Type == 'tc'">
            <p *ngIf="returnCode2 == 1">This month was already Posted and finalized.</p>
            <p *ngIf="returnCode2 == 2">This month was already Temporarily Closed.</p>
            <p *ngIf="returnCode2 == 3">Production was not yet done. Please run Batch Production first.<br />
                                        Right after, run the batch OS, then generate the Trial Balance.</p>
            <p *ngIf="returnCode2 == 4">Batch OS was not yet done. Please run Batch OS first, then generate the Trial Balance.</p>
          </ng-container>
          <ng-container *ngIf="mdl2Type == 'ro'">
            <p *ngIf="returnCode2 == 1">This month was already Posted and finalized.</p>
            <p *ngIf="returnCode2 == 2">This month is not yet closed. Cannot be re-opened.</p>
          </ng-container>
        </div>
    </div>
    <div footer class="w-100 text-center">
        <button class="cust-btn" type="button" (click)="eomTbMdl2.closeModal();"><a>{{ 'Ok' }}</a></button>
    </div>
</app-modal>

<!-- <app-modal #printMdl class="d-none">
  <div header>Print</div>
  <div body>
    <div class="text-center">
      <div class="input-group">
        <label class="form-control-sm col-sm-4" style="margin: 0px !important">Destination</label>
        <select class="form-control form-control-sm cust-sm col-sm-6" [(ngModel)]="printMethod">
          <option [value]="'1'">EXCEL</option>
        </select>
      </div>
    </div>
  </div>
  <div footer class="w-100 text-center">
    <button class="cust-btn" type="button" (click)="printMdl.closeModal();"><a>Cancel</a></button>
    <button class="cust-btn" type="button" [disabled]="printMethod.length == 0" [class.cust-btn-disabled]="printMethod.length == 0" (click)="printMdl.closeModal(); export();"><a>Ok</a></button>
  </div>
</app-modal> -->

<app-modal #printMdl class="d-none">
  <div header>Print Report</div>
  <div body style="min-width: 550px;">
    <div class="row">
      <fieldset class="scheduler-border col-sm cust-fs">
        <div class="input-group">
          <label class="form-control-sm col-sm-2 cust-lbl">Report Name</label>
          <input type="text" class="form-control form-control-sm col-sm-2" [ngModel]="params.reportId" (ngModelChange)="params.reportId=$event.toUpperCase()" (change)="checkCode($event, 'report')" appRequired>
          <div class="text-search-ico"><a><i class="fa fa-search" (click)="openReportMdl()"></i></a></div>
          <span>&nbsp;</span>
          <input type="text" class="form-control form-control-sm col-sm cap-input" [(ngModel)]="params.reportName" readonly>
        </div>
      </fieldset>
    </div>
    <div class="row">
      <fieldset class="scheduler-border col-sm cust-fs">
        <legend class="scheduler-border" style="visibility: hidden; padding-top: 24px !important; padding-left: 0px !important; padding-right: 0px !important;"></legend>
        <div class="input-group">
          <div class="col-sm-3"></div>
          <label class="form-control-sm col-sm-3 cust-lbl">End of Month Date</label>
          <div class="dp-cont col-sm-3" style="margin-left: 0 !important;">
            <datepicker [type]="'date'" [(value)]="params.eomDate" [disabled]="paramsToggle.indexOf('eomDate') == -1"></datepicker>
          </div>
          <div class="col-sm-3"></div>
        </div>
      </fieldset>
    </div>
    <div class="row">
      <fieldset class="scheduler-border col-sm cust-fs">
        <legend class="scheduler-border" style="visibility: hidden; padding-top: 24px !important; padding-left: 0px !important; padding-right: 0px !important;"></legend>
        <div class="input-group" style="margin-bottom: -4px !important;">
          <label class="form-control-sm col-sm-2 cust-lbl">Company</label>
          <input type="text" class="form-control form-control-sm col-sm-2" [(ngModel)]="params.cedingId" (change)="checkCode($event, 'cedingId')" [disabled]="paramsToggle.indexOf('cedingId') == -1">
          <div class="text-search-ico" *ngIf="paramsToggle.indexOf('cedingId') > -1"><a><i class="fa fa-search" (click)="openCedingMdl()"></i></a></div>
          <span>&nbsp;</span>
          <input type="text" class="form-control form-control-sm col-sm cap-input" [(ngModel)]="params.cedingName" readonly placeholder="ALL COMPANIES">
        </div>
        <div class="input-group">
          <label class="form-control-sm col-sm-2 cust-lbl">Currency</label>
          <input type="text" class="form-control form-control-sm col-sm-2" [ngModel]="params.currCd" (ngModelChange)="params.currCd=$event.toUpperCase()" (change)="checkCode($event, 'currCd')" [disabled]="paramsToggle.indexOf('currCd') == -1">
          <div class="text-search-ico" *ngIf="paramsToggle.indexOf('currCd') > -1"><a><i class="fa fa-search" (click)="openCurrencyMdl()"></i></a></div>
          <span>&nbsp;</span>
          <input type="text" class="form-control form-control-sm col-sm cap-input" [(ngModel)]="params.currency" readonly placeholder="ALL CURRENCIES">
        </div>
      </fieldset>
    </div>
    <div class="row">
      <fieldset class="scheduler-border col-sm cust-fs">
        <legend class="scheduler-border" style="visibility: hidden; padding-top: 24px !important; padding-left: 0px !important; padding-right: 0px !important;"></legend>
        <div class="input-group">
          <div class="col-sm-3"></div>
          <label class="form-control-sm col-sm-3 cust-lbl">Destination</label>
          <select class="form-control form-control-sm cust-sm col-sm-3" [(ngModel)]="params.destination" [disabled]="paramsToggle.indexOf('destination') == -1">
            <option *ngIf="allDest" value="screen">Screen</option>
            <option *ngIf="allDest" value="dlPdf">PDF</option>
            <option *ngIf="allDest" value="printPdf">Printer</option>
            <option value="exl">Excel</option>
          </select>
          <div class="col-sm-3"></div>
        </div>
      </fieldset>
    </div>
  </div>
  <div footer class="w-100 text-center">
    <ng-container *ngIf="ps.printLoader">
      <span class="fa fa-spinner fa-spin" style="font-size: 15px;"></span><span style="font-family: Arial; font-size: 15px;">&nbsp;Please wait</span>
    </ng-container>
    <ng-container *ngIf="!ps.printLoader">
      <button class="cust-btn" type="button" (click)="printMdl.closeModal();"><a>Cancel</a></button>
      <button class="cust-btn" type="button" [disabled]="params.reportId == '' || params.eomDate == ''" (click)="print();"><a>Print</a></button>
    </ng-container>

    <!-- <button class="cust-btn" type="button" (click)="printMdl.closeModal();"><a>Cancel</a></button>
    <button class="cust-btn" type="button" [disabled]="params.reportId == '' || params.eomDate == ''" (click)="printMdl.closeModal(); print();"><a>Print</a></button> -->
  </div>
</app-modal>

<app-modal #postMdl class="d-none">
  <div header>Post GL to Fiscal Year</div>
  <div body>
    <div class="text-center">
      <div class="input-group">
        <p class="form-control-sm col-sm-12" style="margin-bottom: 5px;">Are you sure you want to post to Fiscal Year the close GLs for this month?</p>
      </div>
      <div class="input-group">
        <label class="form-control-sm col-sm-3" style="margin: 0px !important">Year</label>
        <input type="text" class="form-control form-control-sm col-sm-3 text-right" mask="0000" [(ngModel)]="eomYear">
        <label class="form-control-sm col-sm-2" style="margin: 0px !important">Month</label>
        <input type="text" class="form-control form-control-sm col-sm-3 text-right" mask="00" [(ngModel)]="eomMm">
        <div style="margin-left: 6px !important; z-index: 200; font-size: 14px;"><a (click)="showLov()"><i class="fa fa-search"></i></a></div>
        <div class="col-sm-2"></div>
      </div>
    </div>
  </div>
  <div footer class="w-100 text-center">
    <button class="cust-btn" type="button" (click)="postMdl.closeModal();"><a>Cancel</a></button>
    <button class="cust-btn" type="button" (click)="post();"><a>Post</a></button>
  </div>
</app-modal>

<app-modal #lovMdl class="d-none">
  <div header>List of Values</div>
  <div body>
    <app-cust-non-datatable [passData]="unpostedMonthsData" (rowClick)="selected=$event"></app-cust-non-datatable>
  </div>
  <div footer class="w-100 text-center">
    <button class="cust-btn" type="button" (click)="lovMdl.closeModal();"><a>Cancel</a></button>
    <button class="cust-btn" type="button" (click)="lovMdl.closeModal(); setSelected();"><a>Ok</a></button>
  </div>
</app-modal>

<app-sucess-dialog #eomTbDialog [icon]="dialogIcon" [message]="dialogMessage" (onOk)="returnCode == -1 ? getAcitMonthEndTrialBal(tranDate) : null"></app-sucess-dialog>
<app-sucess-dialog #eomTbDialog2 [icon]="dialogIcon2" [message]="dialogMessage2" (onOk)="postReturnCode == -1 ? getAcitMonthEndUnpostedMonths() : null"></app-sucess-dialog>
<img src="app/resources/images/Loading_icon2.gif" alt="loading.gif" class="globalLoading" style="position: absolute;top:50%;left:50%;-ms-transform: translate(-50%,-50%);transform: translate(-50%,-50%);z-index: 999999;display: none">
<div class="globalLoading" style="position: absolute;top:0;left:0;width: 100%;height: 100%;z-index: 991;background-color: rgba(255, 255, 255, 0.5);display: none">
</div>

<app-lov #reportMdl [passData]="passLov" (selectedData)="setReport($event)">
<app-ceding-company #cedingMdl (selectedData)="setCeding($event)"></app-ceding-company>
<app-mtn-currency-code  #currencyMdl (selectedData)="setCurrency($event)"></app-mtn-currency-code>